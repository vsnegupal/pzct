<p>Всем привет!</p>
<p>В январе 2022 года я решил запустить свой собственный сервер для игры Project Zomboid. Условия позволяли мне использовать для этого отдельный компьютер дома. Я был знаком с ОС семейства GNU/Linux. Поэтому я решил, что сервер будет работать на компьютере с Linux.</p>
<p>Управляя сервером, я понял, что это совсем не просто. Управление сводилось к выполнению команд команд в консоли. Различные действия требовали выполнения различных команд. Нужно было либо запомнить эти команды, либо обращаться к их списку. Команды нужно было выполнять в определенной последовательности. Кроме того, это отнимало много времени.</p>
<p>В то время я умел писать примитивные скрипты для Unix shell. Я написал несколько простых скриптов, и стал запускать их, когда это было нужно. Управлять сервером стало проще. Но результат всё равно меня не устраивал. Решение простых задач позволяло подумать о более сложных. Я пришел к выводу, что хочу иметь один скрипт, который будет выполнять те или иные действия, которые я укажу. В это же время меня повысили на работе. Мне стало нужно уметь писать более сложные скрипты. Я понял, что лучшей возможности для обучения мне не представится. Поэтому взялся за сооружение pzct.</p>
<p>Сначала я повторил основные механики, которые были у меня в виде отдельных скриптов, такие как start, quit и backup. Я написал довольно простую, и, как мне кажется, удачную проверку того, запущен или не запущен процесс сервера, что позволяет выполнять или не выполнять действия с сервером. Сложность возникла при написании функции внутриигровых уведомлений перед остановкой сервера. С этим мне помог человек с никнеймом joljaycups из Discord, за что я выражаю ему благодарность. После этого, путем комбинации функций, я смог получить опцию restart. Этот первый ключевой момент в разработке позволяет мне представить утилиту pzct вам.</p>
<p>Изначально я расчитывал только на личное пользование скриптом. Однако, если кому-то из вас это будет полезно, то вы тоже можете пользоваться pzct. Главной задачей, которую я старался реализовать на данный момент, является возможность создать задание для cron по перезагрузке сервера через равные промежутки времени. Таким образом я расчитываю решить проблему, когда игрок не может подключиться к серверу из-за необновленного мода на сервере. Конечно, это не очень удобно, ведь обновление мода может случиться вскоре после очередной перезагрузки. Но в основном этого должно быть достаточно. В текущем виде это уже позволяет оставить сервер работать на долгое время. Кроме того, я продолжу совершенствовать утилиту pzct, поэтому в будущем ее функционал будет расширен.</p><br>
<p>Имейте в виду, что для работы pzct вам нужно, чтобы в системе присутствовала настроенная программа rcon-cli. Вы можете скачать ее, перейдя по ссылке https://github.com/itzg/rcon-cli. Поскольку rcon-cli не является моей разработкой, в данный момент ее настройку мы рассматривать не будем. Впрочем, это должно быть довольно просто.</p><br>
<p>После того, как вы скачаете pzct.sh, откройте этот файл в редакторе и исправьте значения параметров (переменных) SERVDIR, ZDIR, LOGFILE, BAKDIR, CMDDIR, RCON и RCONYAML. Можете также найти строчку "INGAME NOTIFICATIONS BELOW", и в двух строчках после нее исправить уведомления на свои собственные.</p><br>
<p>После этого проверьте работу утилиты pzct. Исправив "/path/to" ниже на свое собственное значение:</p>
<p>1. выполните команду "/path/to/pzct.sh quit" при запущенном сервере - сервер должен выключиться с уведомлением в игре.</p>
<p>2. выполните команду "/path/to/pzct.sh backup" - в каталоге, который вы указали в переменной BAKDIR, должен появиться файл "bak.tar.gz" или "bak.tar.bz2".</p>
<p>3. выполните команду "/path/to/pzct.sh start" - ваш сервер должен запуститься.</p>
<p>4. выполните команду "/path/to/pzct.sh message test1 test2" - вы должны увидеть текст "test1 test2" в игровом чате и посередине игрового окна.</p><br>
<p>Если всё ОК, то это значит, что вы можете создать задание для cron по автоматической перезагрузке сервера. Выполните команду "crontab -e" и вставьте в новую строку текст "0 0,8,16 * * * nohup /opt/pzbackup/pzct.sh restart &>/dev/null" если хотите, чтобы сервер перезагружался ежедневно в 0, 8 и 16 часов. Уточните в интернете, как работать с cron в вашей системе.</p><br>
<p>Этот проект для меня является образовательным. В нем наверняка присутствуют моменты, которые опытные люди сочтут неоптимальными или неверными. Если вы хотите предложить исправление или свой вариант в реализации того или иного момента, то не стесняйтесь это сделать. Хотя я и достиг того минимума, на который расчитывал, но продолжу исправлять и улучшать утилиту pzct в будущем.</p><br>
<p>Вы можете связаться со мной в Telegram: https://t.me/vsnegupal или написав на почту vsnegupal@gmail.com (быстрый ответ не гарантируется).</p><br>
<p>Благодарю за внимание!</p>
